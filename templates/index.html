<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Sample Split</title>
<link href="https://fonts.googleapis.com/css2?family=Exo+2:wght@400;600&family=Poppins:wght@300;400&display=swap" rel="stylesheet" />
<style>
  body {
    font-family: 'Poppins', sans-serif;
    background-color: #0b0f1a;
    color: #f1f5f9;
    margin: 0;
    padding: 40px;
    display: flex;
    justify-content: center;
  }
  .container {
    max-width: 900px;
    background: #151e3a;
    border-radius: 16px;
    padding: 32px;
    box-shadow: 0 0 15px rgba(0, 170, 255, 0.15);
  }
  h2 {
    text-align: center;
    font-family: 'Exo 2', sans-serif;
    font-size: 28px;
    margin-bottom: 30px;
  }
  label { font-weight: 500; font-size: 14px; }

  .section-header {
    font-family: 'Exo 2', sans-serif;
    font-size: 18px;
    color: #90cdf4;
    margin-top: 30px;
    margin-bottom: 10px;
    border-bottom: 1px solid #2d3a68;
    padding-bottom: 5px;
  }

  .channels-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 20px;
    margin: 25px 0 35px;
  }
  .channel-card {
    background: #10182d;
    border-radius: 12px;
    padding: 18px;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
    border: 1px solid #1e2b4e;
    transition: border-color 0.3s ease, box-shadow 0.3s ease;
  }
  .channel-card:hover {
    border-color: #3aa0ff;
    box-shadow: 0 0 12px rgba(0, 150, 255, 0.25);
  }
  .channel-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 8px;
  }
  .channel-header label {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 15px;
  }
  .channel-header input[type="checkbox"] {
    width: 16px; height: 16px; accent-color: #007bff;
  }
  .stems {
    display: flex;
    flex-wrap: wrap;
    gap: 6px;
    margin-bottom: 8px;
  }
  .stem-toggle {
    background: #1b2544;
    color: #d0d8ef;
    border: 1px solid #2a3664;
    border-radius: 6px;
    padding: 4px 9px;
    font-size: 12px;
    cursor: pointer;
    transition: all 0.2s ease;
  }
  .stem-toggle.active {
    background: linear-gradient(135deg, #0066ff, #00ccff);
    color: #fff;
    border-color: transparent;
    box-shadow: 0 0 6px rgba(0, 170, 255, 0.3);
  }
  .stem-toggle:hover { background: #23315a; }

  .channel-comment {
    width: 100%;
    border: none;
    border-radius: 6px;
    background-color: #1b2544;
    color: #cbd5e1;
    padding: 8px;
    font-size: 12.5px;
    height: 38px;
    resize: none;
    transition: background-color 0.2s ease;
  }
  .channel-comment:focus { background-color: #24325e; outline: none; }

  input[type="text"], input[type="number"], input[type="datetime-local"], select, textarea {
    width: 100%;
    padding: 10px;
    border-radius: 8px;
    border: none;
    background-color: #2d3748;
    color: white;
    margin-bottom: 16px;
  }

  textarea { resize: none; }

  .radio-row label, .checkbox-row label {
    display: flex;
    align-items: center;
    gap: 8px;
    margin-bottom: 6px;
  }

  .split-button {
    display: block;
    width: 100%;
    text-align: center;
    padding: 12px 0;
    border-radius: 10px;
    font-family: 'Exo 2', sans-serif;
    font-weight: 600;
    font-size: 16px;
    color: white;
    background: linear-gradient(135deg, #00306f, #001a33);
    border: none;
    cursor: pointer;
    transition: box-shadow 0.3s ease, transform 0.3s ease;
  }
  .split-button:hover {
    box-shadow: 0 0 18px rgba(0, 85, 170, 0.7);
    transform: scale(1.02);
  }

  .progress-container { margin-top: 20px; }
  .progress-bar {
    width: 100%;
    height: 20px;
    border-radius: 10px;
    background: #2d3748;
    overflow: hidden;
    position: relative;
  }
  .progress-fill {
    height: 100%;
    width: 0%;
    background-color: #007bff;
    transition: width 0.3s ease;
  }
  .progress-label {
    margin-top: 8px;
    font-size: 13px;
    text-align: left;
    color: #cbd5e1;
  }
</style>
</head>
<body>
  <div class="container">
    <h2>Sample Split</h2>

    <label for="playlistId">Playlist ID</label>
    <input type="text" id="playlistId" placeholder="Enter playlist ID..." />

    <label>Upload to Channels</label>
    <div class="channels-grid" id="channelsGrid"></div>

    <div class="section-header">Scheduling</div>
    <label for="scheduleStart">Start Time</label>
    <input type="datetime-local" id="scheduleStart" />

    <label for="interval">Interval</label>
    <select id="interval">
      <option value="3600000">Every Hour</option>
      <option value="7200000">Every 2 Hours</option>
      <option value="14400000">Every 4 Hours</option>
      <option value="86400000">Daily</option>
    </select>

    <div class="section-header">Video Metadata</div>
    <label for="genre">Genre</label>
    <select id="genre">
      <option value="hiphop">Hip-Hop</option>
      <option value="rnb">R&B</option>
      <option value="jazz">Jazz</option>
      <option value="soul">Soul</option>
      <option value="rock">Rock</option>
      <option value="pop">Pop</option>
      <option value="electronic">Electronic</option>
      <option value="world">World</option>
    </select>

    <label for="videoDesc">Default Video Description</label>
    <textarea id="videoDesc" rows="3" placeholder="Include hashtags, links, etc."></textarea>

    <label for="videoTags">YouTube Tags</label>
    <input type="text" id="videoTags" placeholder="e.g. hiphop, remix, acapella" />

    <label for="privacy">Privacy</label>
    <select id="privacy">
      <option value="public">Public</option>
      <option value="unlisted">Unlisted</option>
      <option value="private" selected>Private</option>
    </select>

    <label>Audience</label>
    <div class="radio-row">
      <label><input type="radio" name="audience" id="audienceKids" /> Made for Kids</label>
      <label><input type="radio" name="audience" id="audienceNotKids" checked /> Not Made for Kids</label>
    </div>

    <div class="section-header">Options</div>
    <div class="checkbox-row">
      <label><input type="checkbox" id="monetize" /> Enable Monetization</label>
      <label><input type="checkbox" id="uploadYouTube" /> Upload to YouTube</label>
      <label><input type="checkbox" id="trimTrack" /> Trim Track</label>
    </div>

    <label for="trimLength">Trim Length (seconds)</label>
    <input type="number" id="trimLength" placeholder="e.g. 60" />

    <button class="split-button" onclick="runSplit()">Start Split</button>

    <div class="progress-container">
      <div class="progress-bar"><div class="progress-fill" id="progressFill"></div></div>
      <div class="progress-label" id="progressText">Progress 0%</div>
    </div>
  </div>

<script>
const stems = ["Acapella", "Drums", "Bass", "Instrumental", "Melody"];
const channels = ["Main", "Backup", "Drum", "Vocal", "Sample Split", "TikTok"];
const grid = document.getElementById("channelsGrid");

channels.forEach(ch => {
  const id = ch.toLowerCase().replace(/\s/g, '');
  const card = document.createElement("div");
  card.className = "channel-card";
  card.innerHTML = `
    <div class="channel-header">
      <label><input type="checkbox" id="${id}Channel"> ${ch}</label>
    </div>
    <div class="stems" id="${id}Stems">
      ${stems.map(s => `<div class="stem-toggle" data-stem="${s.toLowerCase()}">${s}</div>`).join("")}
    </div>
    <textarea id="${id}Comment" class="channel-comment" placeholder="Optional comment for ${ch}..."></textarea>
  `;
  grid.appendChild(card);
});

document.querySelectorAll(".stem-toggle").forEach(btn => {
  btn.addEventListener("click", () => btn.classList.toggle("active"));
});

function runSplit() {
  // Gather UI input values
  const playlistId = document.getElementById('playlistId').value;
  const genre = document.getElementById('genre').value;
  const startTime = document.getElementById('scheduleStart').value;
  const interval = document.getElementById('interval').value;
  const description = document.getElementById('videoDesc').value;
  const tagsInput = document.getElementById('videoTags').value;
  const tags = tagsInput ? tagsInput.split(',').map(t => t.trim()).filter(t => t) : [];
  const privacy = document.getElementById('privacy').value;
  const monetize = document.getElementById('monetize').checked;
  const uploadYouTube = document.getElementById('uploadYouTube').checked;
  const trimTrack = document.getElementById('trimTrack').checked;
  const trimLength = parseInt(document.getElementById('trimLength').value) || 0;
  const madeForKids = document.getElementById('audienceKids').checked;

  // Build per-channel configuration
  const selectedChannels = [];
  const comments = {};

  channels.forEach(ch => {
    const id = ch.toLowerCase().replace(/\s/g, '');
    const enabled = document.getElementById(id + "Channel").checked;
    if (enabled) {
      selectedChannels.push(id);
      const channelComment = document.getElementById(id + "Comment").value;
      if (channelComment) {
        comments[id] = channelComment;
      }
    }
  });

  if (selectedChannels.length === 0) {
    alert("Please select at least one channel.");
    return;
  }

  // Build request payload matching StemRequest model
  const payload = {
    track_id: playlistId,
    channels: selectedChannels,
    yt: uploadYouTube,
    dry_run: false,
    ec2: false,
    trim: trimTrack,
    trim_length: trimLength,
    genre: genre,
    description: description,
    tags: tags,
    privacy: privacy,
    made_for_kids: madeForKids,
    monetize: monetize,
    comments: comments,
    startTime: startTime,
    interval: interval,
    tz: "America/Chicago"
  };

  console.log("Sending request:", payload);

  // Send to backend
  fetch('/split', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(payload)
  })
    .then(res => res.json())
    .then(data => {
      console.log("Response:", data);
      
      // Show progress
      let progress = 0;
      const fill = document.getElementById("progressFill");
      const text = document.getElementById("progressText");
      const intervalId = setInterval(() => {
        progress += 2;
        if (progress > 100) progress = 100;
        fill.style.width = progress + "%";
        text.textContent = `Progress ${progress}%`;
        if (progress >= 100) clearInterval(intervalId);
      }, 500);

      alert(` Processing started\n${data.message}\nTracks: ${data.tracks_processed}`);
    })
    .catch(err => {
      console.error("Error:", err);
      alert(" Error: " + err.message);
    });
}
</script>
</body>
</html>
